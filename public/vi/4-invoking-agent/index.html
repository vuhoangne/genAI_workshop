<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.146.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="//localhost:1313/images/favicon.png" type="image/png">

    <title>Thực thi Amazon Bedrock Agent :: Thiết lập AWS Account</title>

    
    <link href="//localhost:1313/css/nucleus.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/fontawesome-all.min.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/hybrid.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/featherlight.min.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/perfect-scrollbar.min.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/auto-complete.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/atom-one-dark-reasonable.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/theme.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/hugo-theme.css?1748172313" rel="stylesheet">
    
    <link href="//localhost:1313/css/theme-workshop.css?1748172313" rel="stylesheet">
    
    

    <script src="//localhost:1313/js/jquery-3.3.1.min.js?1748172313"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="//localhost:1313/vi/4-invoking-agent/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="//localhost:1313/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="//localhost:1313/js/lunr.min.js?1748172313"></script>
<script type="text/javascript" src="//localhost:1313/js/auto-complete.js?1748172313"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/\/vi";
    
</script>
<script type="text/javascript" src="//localhost:1313/js/search.js?1748172313"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduction/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/1-introduction/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-module1/" title="Module 1" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/2-module1/">
           <b> 2. </b> Module 1
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-module2/" title="Module 2" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/">
           <b> 3. </b> Module 2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.1-use-amazon-bedrock-playground/" title="Use Amazon Bedrock Playground" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.1-use-amazon-bedrock-playground/">
           <b> 3.1 </b> Use Amazon Bedrock Playground
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/" title="Use Amazon Bedrock API" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/">
           <b> 3.2 </b> Use Amazon Bedrock API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.1-generating-images-with-amazon-bedrock/" title="Generating Images with Amazon Bedrock" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.1-generating-images-with-amazon-bedrock/">
           <b> 3.2.1 </b> Generating Images with Amazon Bedrock
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.2-generating-text-with-amazon-bedrock/" title="Generating Text with Amazon Bedrock" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.2-generating-text-with-amazon-bedrock/">
           <b> 3.2.2 </b> Generating Text with Amazon Bedrock
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.3-understanding-video-with-amazon-bedrock/" title="Understanding Video with Amazon Bedrock" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.3-understanding-video-with-amazon-bedrock/">
           <b> 3.2.3 </b> Understanding Video with Amazon Bedrock
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/" title="Thực thi Amazon Bedrock Agent" class="dd-item 
        
        active
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/">
           <b> 4. </b> Thực thi Amazon Bedrock Agent
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/4.1-invoking-code-interpreter/" title="Thực Thi Trình Biên Dịch Code" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/4.1-invoking-code-interpreter/">
           <b> 4.1. </b> Thực Thi Trình Biên Dịch Code
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/4.2-sending-files-to-agent/" title="Gửi files cho Agent" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/4.2-sending-files-to-agent/">
           <b> 4.2. </b> Gửi files cho Agent
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/4.3-generating-files-with-code-interpreter/" title="Tạo File với Trình Thông Dịch Mã" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/4.3-generating-files-with-code-interpreter/">
           <b> 4.3. </b> Tạo File với Trình Thông Dịch Mã
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-resource-clean-up/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/5-resource-clean-up/">
           <b> 5. </b> Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-conclusion/" title="Kết luận" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/6-conclusion/">
           <b> 6. </b> Kết luận
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/4-invoking-agent/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/4-invoking-agent/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830891&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>25/05/2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/jotaguy/"  style="color:orange">Gia Hưng</a> <br>
                <a href="https://www.linkedin.com/in/vanhoangkha/"  style="color:orange">Kha Văn</a> <br>
                <a href="https://www.linkedin.com/in/lenguyenvuhoang-hayden/"  style="color:orange">Vũ Hoàng</a> <br>
            </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='//localhost:1313/vi/'>Building with Generative AI on AWS using PartyRock, Amazon Bedrock, and Amazon Q</a> > Thực thi Amazon Bedrock Agent
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Thực thi Amazon Bedrock Agent
            </h1>
          

        



	<h4 id="thực-thi-agent"><strong>Thực thi Agent</strong></h4>
<p>Chúng ta sẽ định nghĩa một helper function để invoke agent và parse responses của nó, sau đó invoke nó để xem cách nó sử dụng code invocation.</p>
<h4 id="chuẩn-bị-draft-version-của-agent"><strong>Chuẩn bị DRAFT Version của Agent</strong></h4>
<p>Trước tiên, chúng ta sẽ tạo một DRAFT version của agent để phục vụ internal testing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>response <span style="color:#f92672">=</span> bedrock_agent_client<span style="color:#f92672">.</span>prepare_agent(
</span></span><span style="display:flex;"><span>    agentId<span style="color:#f92672">=</span>agent_id
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>print(response)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Pause to make sure agent is prepared</span>
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract agentAliasId from response</span>
</span></span><span style="display:flex;"><span>agent_alias_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;TSTALIASID&#34;</span> <span style="color:#75715e"># This ID is for testing purpose</span>
</span></span></code></pre></div><p><img src="//localhost:1313/images/4-invoking-agent/image.png" alt="create-draft-version"></p>
<hr>
<h4 id="helper-function-xử-lý-invoke-agent"><strong>Helper function xử lý invoke agent</strong></h4>
<p>Helper function này có thể invoke agent và parse stream của returned responses.</p>
<p>Function <code>invoke_agent_helper</code> cho phép user gửi một <code>query</code> đến agent với một <code>session_id</code>. Một session định nghĩa một lượt trao đổi qua lại giữa user và agent. Agent có thể ghi nhớ toàn bộ context trong một session. Khi user kết thúc session, context này sẽ bị xóa.</p>
<p>User có thể:</p>
<ul>
<li>Bật hoặc tắt trace bằng cách sử dụng <code>enable_trace</code> boolean.</li>
<li>Truyền session state như một dictionary qua <code>session_state</code>.</li>
</ul>
<p>Nếu một <code>session_id</code> mới được cung cấp, agent sẽ tạo một new conversation mà không có context trước đó. Nếu cùng <code>session_id</code> được reuse, conversation context liên quan đến session đó sẽ được agent ghi nhớ.</p>
<p>Nếu <code>enable_trace = True</code>, mỗi response từ agent sẽ đi kèm với một <strong>trace</strong> detailing step mà agent đã orchestrate để đưa ra final response (<em>reasoning via Chain of Thoughts prompting</em>).</p>
<p>Parameter <code>memory_id</code> được sử dụng để handle memory capabilities. Khi một session kết thúc, nó sẽ summarize content vào một new session id như một phần của <code>memory_id</code>.</p>
<h5 id="session-state"><strong>Session State</strong></h5>
<p>User có thể pass session context bằng cách sử dụng <code>session_state</code>, với các options sau:</p>
<ul>
<li><strong><code>sessionAttributes</code></strong>: attributes tồn tại trong suốt một session giữa user và agent. Tất cả invokeAgent calls với cùng <code>session_id</code> thuộc về cùng một session và sẽ share <code>sessionAttributes</code> với nhau, miễn là session chưa hết hạn hoặc user chưa end session. <code>sessionAttributes</code> chỉ khả dụng trong Lambda function và <strong>không</strong> được thêm vào agent prompt.</li>
<li><strong><code>promptSessionAttributes</code></strong>: attributes tồn tại trong một single invokeAgent call. Prompt attributes được thêm vào prompt và Lambda function.</li>
<li><strong><code>invocationId</code></strong>: ID được agent trả về trong <code>ReturnControlPayload</code> khi có return control invocation.</li>
<li><strong><code>returnControlInvocationResults</code></strong>: results thu được từ invocation action bên ngoài Amazon Bedrock Agents.</li>
</ul>
<p>Nếu <code>show_code_use</code> được pass là <code>True</code>, helper sẽ print một message khi code interpreter được invoke. Nó cũng tự động bật tracing để thực hiện điều này.</p>
<p>Chúng ta sẽ sử dụng test <code>agent_alias_id</code> là <code>&quot;TSTALIASID&quot;</code>, một default value để test agent trong quá trình development. Khi deploy agent, bạn có thể tạo một new version và lấy một agent alias id mới.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">invoke_agent_helper</span>(
</span></span><span style="display:flex;"><span>    query, session_id, agent_id, alias_id, enable_trace<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, memory_id<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, session_state<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, end_session<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, show_code_use<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> session_state:
</span></span><span style="display:flex;"><span>        session_state <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Invoke agent API</span>
</span></span><span style="display:flex;"><span>    agent_response <span style="color:#f92672">=</span> bedrock_agent_runtime_client<span style="color:#f92672">.</span>invoke_agent(
</span></span><span style="display:flex;"><span>        inputText<span style="color:#f92672">=</span>query,
</span></span><span style="display:flex;"><span>        agentId<span style="color:#f92672">=</span>agent_id,
</span></span><span style="display:flex;"><span>        agentAliasId<span style="color:#f92672">=</span>alias_id,
</span></span><span style="display:flex;"><span>        sessionId<span style="color:#f92672">=</span>session_id,
</span></span><span style="display:flex;"><span>        enableTrace<span style="color:#f92672">=</span>(enable_trace <span style="color:#f92672">|</span> show_code_use), <span style="color:#75715e"># Force tracing on if showing code use</span>
</span></span><span style="display:flex;"><span>        endSession<span style="color:#f92672">=</span>end_session,
</span></span><span style="display:flex;"><span>        memoryId<span style="color:#f92672">=</span>memory_id,
</span></span><span style="display:flex;"><span>        sessionState<span style="color:#f92672">=</span>session_state
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> process_response(agent_response, enable_trace<span style="color:#f92672">=</span>enable_trace, show_code_use<span style="color:#f92672">=</span>show_code_use)
</span></span></code></pre></div><hr>
<h4 id="helper-function-xử-lý-dữ-liệu-trả-về-của-agent"><strong>Helper function xử lý dữ liệu trả về của Agent</strong></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_response</span>(resp, enable_trace: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>, show_code_use: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> enable_trace:
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(pprint<span style="color:#f92672">.</span>pprint(resp))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    event_stream <span style="color:#f92672">=</span> resp[<span style="color:#e6db74">&#39;completion&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> event <span style="color:#f92672">in</span> event_stream:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;chunk&#39;</span> <span style="color:#f92672">in</span> event:
</span></span><span style="display:flex;"><span>                data <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#39;chunk&#39;</span>][<span style="color:#e6db74">&#39;bytes&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> enable_trace:
</span></span><span style="display:flex;"><span>                    logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Final answer -&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                agent_answer <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> agent_answer
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;trace&#39;</span> <span style="color:#f92672">in</span> event:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;codeInterpreterInvocationInput&#39;</span> <span style="color:#f92672">in</span> json<span style="color:#f92672">.</span>dumps(event[<span style="color:#e6db74">&#39;trace&#39;</span>]):
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> show_code_use:
</span></span><span style="display:flex;"><span>                        print(<span style="color:#e6db74">&#34;Invoked code interpreter&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> enable_trace:
</span></span><span style="display:flex;"><span>                    logger<span style="color:#f92672">.</span>info(json<span style="color:#f92672">.</span>dumps(event[<span style="color:#e6db74">&#39;trace&#39;</span>], indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Unexpected event.&#34;</span>, event)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Unexpected event.&#34;</span>, e)
</span></span></code></pre></div>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.3-understanding-video-with-amazon-bedrock/" title="Understanding Video with Amazon Bedrock"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="//localhost:1313/vi/4-invoking-agent/4.1-invoking-code-interpreter/" title="Thực Thi Trình Biên Dịch Code" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="//localhost:1313/js/clipboard.min.js?1748172313"></script>
    <script src="//localhost:1313/js/perfect-scrollbar.min.js?1748172313"></script>
    <script src="//localhost:1313/js/perfect-scrollbar.jquery.min.js?1748172313"></script>
    <script src="//localhost:1313/js/jquery.sticky.js?1748172313"></script>
    <script src="//localhost:1313/js/featherlight.min.js?1748172313"></script>
    <script src="//localhost:1313/js/highlight.pack.js?1748172313"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="//localhost:1313/js/modernizr.custom-3.6.0.js?1748172313"></script>
    <script src="//localhost:1313/js/learn.js?1748172313"></script>
    <script src="//localhost:1313/js/hugo-learn.js?1748172313"></script>

    <link href="//localhost:1313/mermaid/mermaid.css?1748172313" rel="stylesheet" />
    <script src="//localhost:1313/mermaid/mermaid.js?1748172313"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
