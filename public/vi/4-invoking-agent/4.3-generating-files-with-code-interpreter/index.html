<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.146.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="//localhost:1313/images/favicon.png" type="image/png">

    <title>Tạo File với Trình Thông Dịch Mã :: Thiết lập AWS Account</title>

    
    <link href="//localhost:1313/css/nucleus.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/fontawesome-all.min.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/hybrid.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/featherlight.min.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/perfect-scrollbar.min.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/auto-complete.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/atom-one-dark-reasonable.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/theme.css?1748172313" rel="stylesheet">
    <link href="//localhost:1313/css/hugo-theme.css?1748172313" rel="stylesheet">
    
    <link href="//localhost:1313/css/theme-workshop.css?1748172313" rel="stylesheet">
    
    

    <script src="//localhost:1313/js/jquery-3.3.1.min.js?1748172313"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="//localhost:1313/vi/4-invoking-agent/4.3-generating-files-with-code-interpreter/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="//localhost:1313/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="//localhost:1313/js/lunr.min.js?1748172313"></script>
<script type="text/javascript" src="//localhost:1313/js/auto-complete.js?1748172313"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/\/vi";
    
</script>
<script type="text/javascript" src="//localhost:1313/js/search.js?1748172313"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduction/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/1-introduction/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-module1/" title="Module 1" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/2-module1/">
           <b> 2. </b> Module 1
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-module2/" title="Module 2" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/">
           <b> 3. </b> Module 2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.1-use-amazon-bedrock-playground/" title="Use Amazon Bedrock Playground" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.1-use-amazon-bedrock-playground/">
           <b> 3.1 </b> Use Amazon Bedrock Playground
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/" title="Use Amazon Bedrock API" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/">
           <b> 3.2 </b> Use Amazon Bedrock API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.1-generating-images-with-amazon-bedrock/" title="Generating Images with Amazon Bedrock" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.1-generating-images-with-amazon-bedrock/">
           <b> 3.2.1 </b> Generating Images with Amazon Bedrock
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.2-generating-text-with-amazon-bedrock/" title="Generating Text with Amazon Bedrock" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.2-generating-text-with-amazon-bedrock/">
           <b> 3.2.2 </b> Generating Text with Amazon Bedrock
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.3-understanding-video-with-amazon-bedrock/" title="Understanding Video with Amazon Bedrock" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/3-module2/3.2-use-amazon-bedrock-api/3.2.3-understanding-video-with-amazon-bedrock/">
           <b> 3.2.3 </b> Understanding Video with Amazon Bedrock
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/" title="Thực thi Amazon Bedrock Agent" class="dd-item 
        parent
        
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/">
           <b> 4. </b> Thực thi Amazon Bedrock Agent
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/4.1-invoking-code-interpreter/" title="Thực Thi Trình Biên Dịch Code" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/4.1-invoking-code-interpreter/">
           <b> 4.1. </b> Thực Thi Trình Biên Dịch Code
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/4.2-sending-files-to-agent/" title="Gửi files cho Agent" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/4.2-sending-files-to-agent/">
           <b> 4.2. </b> Gửi files cho Agent
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-invoking-agent/4.3-generating-files-with-code-interpreter/" title="Tạo File với Trình Thông Dịch Mã" class="dd-item 
        
        active
        
        ">
      <a href="//localhost:1313/vi/4-invoking-agent/4.3-generating-files-with-code-interpreter/">
           <b> 4.3. </b> Tạo File với Trình Thông Dịch Mã
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-resource-clean-up/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/5-resource-clean-up/">
           <b> 5. </b> Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-conclusion/" title="Kết luận" class="dd-item 
        
        
        
        ">
      <a href="//localhost:1313/vi/6-conclusion/">
           <b> 6. </b> Kết luận
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/4-invoking-agent/4.3-generating-files-with-code-interpreter/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/4-invoking-agent/4.3-generating-files-with-code-interpreter/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830891&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>25/05/2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/jotaguy/"  style="color:orange">Gia Hưng</a> <br>
                <a href="https://www.linkedin.com/in/vanhoangkha/"  style="color:orange">Kha Văn</a> <br>
                <a href="https://www.linkedin.com/in/lenguyenvuhoang-hayden/"  style="color:orange">Vũ Hoàng</a> <br>
            </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='//localhost:1313/vi/'>Building with Generative AI on AWS using PartyRock, Amazon Bedrock, and Amazon Q</a> > <a href='//localhost:1313/vi/4-invoking-agent/'>Thực thi Amazon Bedrock Agent</a> > Tạo File với Trình Thông Dịch Mã
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tạo File với Trình Thông Dịch Mã
            </h1>
          

        



	<h4 id="tạo-file-với-trình-thông-dịch-mã"><strong>Tạo File với Trình Thông Dịch Mã</strong></h4>
<p>Các <strong>Amazon Bedrock Agent</strong> có khả năng tạo và trả về file cho người dùng. Chúng có thể tạo file bằng cách sử dụng trí thông minh tích hợp của mô hình để tạo các loại file như <code>.CSV</code>, hoặc bằng cách viết mã sử dụng <strong>trình thông dịch mã (Code Interpreter)</strong> để tạo các file nhị phân, chẳng hạn như biểu đồ dữ liệu. Các file này được trả về thông qua <strong>dòng phản hồi (response stream)</strong>.</p>
<hr>
<h4 id="dòng-phản-hồi-response-stream-của-agent-bedrock"><strong>Dòng Phản Hồi (Response Stream) của Agent Bedrock</strong></h4>
<p>Dòng phản hồi bao gồm các sự kiện được định dạng theo <strong>JSON</strong>, truyền tải thông tin chi tiết về quá trình suy nghĩ và hành động của Agent khi thực hiện theo <a href="https://aws.amazon.com/blogs/aws/preview-enable-foundation-models-to-complete-tasks-with-agents-for-amazon-bedrock/">mô hình ReAct</a> (Reasoning and Acting). Dưới đây là một số trường quan trọng:</p>
<ul>
<li><strong>&lsquo;files&rsquo;</strong>: Chứa các file được tạo ra tự động bởi mô hình LLM của Agent.</li>
<li><strong>&rsquo;trace&rsquo;</strong>: Chứa thông tin về quá trình suy nghĩ và các bước thực hiện của Agent. Có nhiều loại sự kiện trace:
<ul>
<li><strong>&lsquo;modelInvocationInput&rsquo;</strong>: Chứa các thông tin đầu vào khi gọi mô hình.</li>
<li><strong>&lsquo;rationale&rsquo;</strong>: Chứa lý do (rationale) mà Agent đưa ra để thực hiện hành động.</li>
<li><strong>&lsquo;invocationInput&rsquo;</strong>: Chứa chi tiết về các tham số khi gọi nhóm hành động.
<ul>
<li><strong>&lsquo;codeInterpreterInvocationInput&rsquo;</strong>: Chứa mã nguồn mà mô hình tạo ra và chuyển đến trình thông dịch mã.</li>
</ul>
</li>
<li><strong>&lsquo;observation&rsquo;</strong>: Chứa các quan sát quan trọng, bao gồm:
<ul>
<li><strong>&lsquo;codeInterpreterInvocationOutput&rsquo;</strong>: Chứa kết quả cụ thể từ việc thông dịch mã:
<ul>
<li><strong>&rsquo;executionOutput&rsquo;</strong>: Kết quả thực thi mã.</li>
<li><strong>&rsquo;executionError&rsquo;</strong>: Lỗi nếu có trong quá trình thực thi mã.</li>
<li><strong>&lsquo;files&rsquo;</strong>: Các file được tạo ra từ việc thông dịch mã.</li>
</ul>
</li>
<li><strong>&lsquo;finalResponse&rsquo;</strong>: Phản hồi cuối cùng của Agent.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Chúng ta sẽ định nghĩa lại <strong>helper function</strong> để thu thập các file từ dòng phản hồi. Sau đó, sử dụng nó để lưu các file được tạo bởi Agent, dù thông qua trí thông minh của mô hình hay thông qua trình thông dịch mã, và trả về cho người dùng.</p>
<hr>
<h4 id="định-nghĩa-lại-helper-function"><strong>Định Nghĩa Lại Helper Function</strong></h4>
<p>Chúng ta sẽ định nghĩa lại hàm <code>process_response</code> để thu thập và hiển thị chi tiết phong phú hơn từ dòng phản hồi. Để hỗ trợ hiển thị trong notebook, chúng ta sử dụng thư viện <code>IPython.display</code> để hiển thị các file trả về một cách trực quan, chẳng hạn như nhúng hình ảnh hoặc hiển thị mã nguồn.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> display, Markdown
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.<span style="color:#f92672">/</span>images<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span><span style="color:#f92672">-</span>invoking<span style="color:#f92672">-</span>agent<span style="color:#f92672">/</span><span style="color:#ae81ff">4.3</span><span style="color:#f92672">-</span>generating<span style="color:#f92672">-</span>files<span style="color:#f92672">-</span><span style="color:#66d9ef">with</span><span style="color:#f92672">-</span>code<span style="color:#f92672">-</span>interpreter<span style="color:#f92672">/</span>image <span style="color:#66d9ef">as</span> mpimg
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_response</span>(resp, enable_trace:bool<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, show_code_use:bool<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> resp[<span style="color:#e6db74">&#39;ResponseMetadata&#39;</span>][<span style="color:#e6db74">&#39;HTTPStatusCode&#39;</span>] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;API Response was not 200: </span><span style="color:#e6db74">{</span>resp<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    event_stream <span style="color:#f92672">=</span> resp[<span style="color:#e6db74">&#39;completion&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> event <span style="color:#f92672">in</span> event_stream:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;files&#39;</span> <span style="color:#f92672">in</span> event<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>            files_event <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#39;files&#39;</span>]
</span></span><span style="display:flex;"><span>            display(Markdown(<span style="color:#e6db74">&#34;### Files&#34;</span>))
</span></span><span style="display:flex;"><span>            files_list <span style="color:#f92672">=</span> files_event[<span style="color:#e6db74">&#39;files&#39;</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> this_file <span style="color:#f92672">in</span> files_list:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>this_file[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">{</span>this_file[<span style="color:#e6db74">&#39;type&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>                file_bytes <span style="color:#f92672">=</span> this_file[<span style="color:#e6db74">&#39;bytes&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Lưu byte vào file</span>
</span></span><span style="display:flex;"><span>                file_name <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;output&#39;</span>, this_file[<span style="color:#e6db74">&#39;name&#39;</span>])
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> open(file_name, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>                    f<span style="color:#f92672">.</span>write(file_bytes)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> this_file[<span style="color:#e6db74">&#39;type&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/images/4-invoking-agent/4.3-generating-files-with-code-interpreter/image/png&#39;</span> <span style="color:#f92672">or</span> this_file[<span style="color:#e6db74">&#39;type&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/images/4-invoking-agent/4.3-generating-files-with-code-interpreter/image/jpeg&#39;</span>:
</span></span><span style="display:flex;"><span>                    img <span style="color:#f92672">=</span> mpimg<span style="color:#f92672">.</span>imread(file_name)
</span></span><span style="display:flex;"><span>                    plt<span style="color:#f92672">.</span>imshow(img)
</span></span><span style="display:flex;"><span>                    plt<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;trace&#39;</span> <span style="color:#f92672">in</span> event<span style="color:#f92672">.</span>keys() <span style="color:#f92672">and</span> enable_trace:
</span></span><span style="display:flex;"><span>            trace_event <span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;trace&#39;</span>)[<span style="color:#e6db74">&#39;trace&#39;</span>][<span style="color:#e6db74">&#39;orchestrationTrace&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;modelInvocationInput&#39;</span> <span style="color:#f92672">in</span> trace_event<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;rationale&#39;</span> <span style="color:#f92672">in</span> trace_event<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>                rationale <span style="color:#f92672">=</span> trace_event[<span style="color:#e6db74">&#39;rationale&#39;</span>][<span style="color:#e6db74">&#39;text&#39;</span>]
</span></span><span style="display:flex;"><span>                display(Markdown(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;### Rationale</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>rationale<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;invocationInput&#39;</span> <span style="color:#f92672">in</span> trace_event<span style="color:#f92672">.</span>keys() <span style="color:#f92672">and</span> show_code_use:
</span></span><span style="display:flex;"><span>                inv_input <span style="color:#f92672">=</span> trace_event[<span style="color:#e6db74">&#39;invocationInput&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;codeInterpreterInvocationInput&#39;</span> <span style="color:#f92672">in</span> inv_input:
</span></span><span style="display:flex;"><span>                    gen_code <span style="color:#f92672">=</span> inv_input[<span style="color:#e6db74">&#39;codeInterpreterInvocationInput&#39;</span>][<span style="color:#e6db74">&#39;code&#39;</span>]
</span></span><span style="display:flex;"><span>                    code <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;```python</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>gen_code<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">```&#34;</span>
</span></span><span style="display:flex;"><span>                    display(Markdown(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;### Generated code</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;observation&#39;</span> <span style="color:#f92672">in</span> trace_event<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>                obs <span style="color:#f92672">=</span> trace_event[<span style="color:#e6db74">&#39;observation&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;codeInterpreterInvocationOutput&#39;</span> <span style="color:#f92672">in</span> obs:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;executionOutput&#39;</span> <span style="color:#f92672">in</span> obs[<span style="color:#e6db74">&#39;codeInterpreterInvocationOutput&#39;</span>]<span style="color:#f92672">.</span>keys() <span style="color:#f92672">and</span> show_code_use:
</span></span><span style="display:flex;"><span>                        raw_output <span style="color:#f92672">=</span> obs[<span style="color:#e6db74">&#39;codeInterpreterInvocationOutput&#39;</span>][<span style="color:#e6db74">&#39;executionOutput&#39;</span>]
</span></span><span style="display:flex;"><span>                        output <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;```</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>raw_output<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">```&#34;</span>
</span></span><span style="display:flex;"><span>                        display(Markdown(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;### Output from code execution</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>output<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;executionError&#39;</span> <span style="color:#f92672">in</span> obs[<span style="color:#e6db74">&#39;codeInterpreterInvocationOutput&#39;</span>]<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>                        display(Markdown(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;### Error from code execution</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>obs[<span style="color:#e6db74">&#39;codeInterpreterInvocationOutput&#39;</span>][<span style="color:#e6db74">&#39;executionError&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;files&#39;</span> <span style="color:#f92672">in</span> obs[<span style="color:#e6db74">&#39;codeInterpreterInvocationOutput&#39;</span>]<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>                        display(Markdown(<span style="color:#e6db74">&#34;### Files generated</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>                        display(Markdown(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>obs[<span style="color:#e6db74">&#39;codeInterpreterInvocationOutput&#39;</span>][<span style="color:#e6db74">&#39;files&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;finalResponse&#39;</span> <span style="color:#f92672">in</span> obs:                    
</span></span><span style="display:flex;"><span>                    final_resp <span style="color:#f92672">=</span> obs[<span style="color:#e6db74">&#39;finalResponse&#39;</span>][<span style="color:#e6db74">&#39;text&#39;</span>]
</span></span><span style="display:flex;"><span>                    display(Markdown(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;### Final response</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>final_resp<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> final_resp
</span></span></code></pre></div><hr>
<h4 id="tạo-file-sử-dụng-code-generation"><strong>Tạo File sử dụng Code Generation</strong></h4>
<p>Chúng ta sẽ yêu cầu Agent tạo một file, và file này sẽ được trả về thông qua dòng phản hồi.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Please generate a list of the 10 greatest books of all time. Return it as a CSV file. Always return the file, even if you have provided it before.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>invoke_agent_helper(query, session_id, agent_id, agent_alias_id, enable_trace<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, session_state<span style="color:#f92672">=</span>sessionState,
</span></span><span style="display:flex;"><span>                    memory_id<span style="color:#f92672">=</span>memory_id, show_code_use<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p><img src="//localhost:1313/images/4-invoking-agent/4.3-generating-files-with-code-interpreter/image.png" alt="generates-files"></p>
<hr>
<h4 id="tạo-biểu-đồ-bằng-cách-thông-dịch-mã"><strong>Tạo Biểu Đồ bằng Cách Thông Dịch Mã</strong></h4>
<p>Chúng ta sẽ gửi cùng một file dữ liệu giá cổ phiếu như trước, nhưng lần này yêu cầu Agent tạo một biểu đồ. Agent sẽ viết mã Python để tạo biểu đồ, và trình phân tích dòng phản hồi sẽ hiển thị biểu đồ trực tiếp trong notebook.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Gọi Agent và xử lý dòng phản hồi</span>
</span></span><span style="display:flex;"><span>query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Given the attached price data file, please make me a chart with moving average in red and actual data in blue&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sessionState<span style="color:#f92672">=</span>add_file_to_session_state(stock_file, <span style="color:#e6db74">&#39;CODE_INTERPRETER&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>invoke_agent_helper(query, session_id, agent_id, agent_alias_id, enable_trace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, session_state<span style="color:#f92672">=</span>sessionState,
</span></span><span style="display:flex;"><span>                    memory_id<span style="color:#f92672">=</span>memory_id, show_code_use<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p><img src="//localhost:1313/images/4-invoking-agent/4.3-generating-files-with-code-interpreter/image-1.png" alt="gen-charts"></p>
<hr>
<h4 id="tạo-dữ-liệu-tổng-hợp-và-phân-tích"><strong>Tạo Dữ Liệu Tổng Hợp và Phân Tích</strong></h4>
<p>Chúng ta sẽ yêu cầu Agent tạo hai file CSV và thực hiện phân tích dữ liệu.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Gọi Agent và xử lý dòng phản hồi</span>
</span></span><span style="display:flex;"><span>query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">generate two csv files for me. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">one called SALES, with 3 columns: COMPANY_ID, COMPANY_NAME, and SALES_2024. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">the other called DETAILS, with 3 columns: COMPANY_ID, COMPANY_STATE_CODE. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">follow these rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1) each file should contain 200 companies, and share the same company ID’s. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2) use human readable english words in the names (not random strings of letters and digits), 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">3) use ID’s of the form: C00001. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">4) Only use states that are generally considered to be near the east coast or near the west coast. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">5) Make the revenue from each eastern company range from 0 to $700,000, 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">6) Make revenue from each western company range from $500,000 up to $2,000,000. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">When done, test to be sure you have followed each of the above rules, 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">and produce a chart comparing sales per company in the two regions using box plots.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>invoke_agent_helper(query, session_id, agent_id, agent_alias_id, enable_trace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, session_state<span style="color:#f92672">=</span>sessionState,
</span></span><span style="display:flex;"><span>                    memory_id<span style="color:#f92672">=</span>memory_id, show_code_use<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p><img src="//localhost:1313/images/4-invoking-agent/4.3-generating-files-with-code-interpreter/image-2.png" alt="analytics"></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="//localhost:1313/vi/4-invoking-agent/4.2-sending-files-to-agent/" title="Gửi files cho Agent"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="//localhost:1313/vi/5-resource-clean-up/" title="Dọn dẹp tài nguyên" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="//localhost:1313/js/clipboard.min.js?1748172313"></script>
    <script src="//localhost:1313/js/perfect-scrollbar.min.js?1748172313"></script>
    <script src="//localhost:1313/js/perfect-scrollbar.jquery.min.js?1748172313"></script>
    <script src="//localhost:1313/js/jquery.sticky.js?1748172313"></script>
    <script src="//localhost:1313/js/featherlight.min.js?1748172313"></script>
    <script src="//localhost:1313/js/highlight.pack.js?1748172313"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="//localhost:1313/js/modernizr.custom-3.6.0.js?1748172313"></script>
    <script src="//localhost:1313/js/learn.js?1748172313"></script>
    <script src="//localhost:1313/js/hugo-learn.js?1748172313"></script>

    <link href="//localhost:1313/mermaid/mermaid.css?1748172313" rel="stylesheet" />
    <script src="//localhost:1313/mermaid/mermaid.js?1748172313"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
